(function(e){var t=[];var i={init:function(i){return this.each((function(){var s=this;var l=e(s).data("cbrepeat");if(l){return}l={};l.options=typeof i!="undefined"?i:{};l.defaults=e.fn.cbrepeat.defaults;l.settings=e.extend(true,{},l.defaults,l.options);l.element=e(s);l.rowIndex=0;if(l.settings.useData){e.each(e.fn.cbrepeat.dataMap,(function(e,t){const i=l.element.data(t);if(typeof i!="undefined"){l.settings[e]=i}}))}if(!l.settings.min){l.settings.min=1}l.element.triggerHandler("cbrepeat.init.before",[l]);if(!l.settings.init){return}l.rowIndex=n(l);if(l.settings.sortable){var o=l.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(l.element)})).first();l.element.sortable({placeholder:o.attr("class")+" cbRepeatRowPlaceholder",forcePlaceholderSize:true,cursor:"move",items:".cbRepeatRow",containment:"parent",animated:true,stop:function(t,i){var a=[];l.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(l.element)})).find("input:checked").each((function(){a.push(e(this))}));c(l);e.each(a,(function(e,t){t.prop("checked",true)}));l.element.triggerHandler("cbrepeat.move",[l,t,i])},tolerance:"pointer",handle:".cbRepeatRowMove",opacity:.5})}l.addHandler=function(t){t.preventDefault();t.stopPropagation();var i=l.element.find(".cbRepeatRowAddCount").filter((function(){return e(this).closest(".cbRepeat").is(l.element)}));var n=1;if(i.length&&i.val()>0){n=i.val()}if(l.settings.limit&&n>l.settings.limit){n=l.settings.limit;if(i.length){i.val(n)}}a.call(s,n)};if(l.settings.add){l.element.find(".cbRepeatRowAdd").filter((function(){return e(this).closest(".cbRepeat").is(l.element)})).on("click.cbrepeat",l.addHandler)}l.removeHandler=function(t){t.preventDefault();t.stopPropagation();var i=e(this).closest(".cbRepeatRow");r.call(s,i)};if(l.settings.remove){l.element.find(".cbRepeatRowRemove").filter((function(){return e(this).closest(".cbRepeat").is(l.element)})).on("click.cbrepeat",l.removeHandler)}c(l);l.element.on("remove.cbrepeat destroy.cbrepeat",(function(){l.element.cbrepeat("destroy")}));l.element.on("rebind.cbrepeat",(function(){l.element.cbrepeat("rebind")}));l.element.on("modified.cbrepeat",(function(e,t,i,a){if(i!=a){l.element.cbrepeat("rebind")}}));l.element.on("cloned.cbrepeat",(function(){e(this).off(".cbrepeat");e(this).removeData("cbrepeat");e(this).removeData("uiSortable");e(this).removeData("ui-sortable");var t=e(this).find(".cbRepeatRow").first().parent();e(this).find(".cbRepeatRowAdd").filter((function(){return e(this).closest(".cbRepeat").is(t)})).off("click.cbrepeat",l.addHandler);e(this).find(".cbRepeatRowRemove").filter((function(){return e(this).closest(".cbRepeat").is(t)})).off("click.cbrepeat",l.removeHandler);e(this).cbrepeat(l.options)}));l.element.triggerHandler("cbrepeat.init.after",[l]);l.element.data("cbrepeat",l);t.push(l)}))},add:function(e){if(!e){e=1}a.call(this,e);return this},remove:function(e){r.call(this,e);return this},update:function(){var t=e(this).data("cbrepeat");if(!t){return this}c(t);return this},reset:function(){var t=e(this).data("cbrepeat");if(!t){return this}var i=t.element.find(".cbRepeatRow:not(:first)").filter((function(){return e(this).closest(".cbRepeat").is(t.element)}));i.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");i.remove();c(t);return this},rebind:function(){var t=e(this).data("cbrepeat");if(!t){return this}t.element.cbrepeat("cbrepeat");t.element.cbrepeat(t.options);return this},destroy:function(){var i=e(this).data("cbrepeat");if(!i){return this}if(i.settings.sortable){i.element.sortable("destroy");i.element.removeData("uiSortable");i.element.removeData("ui-sortable")}i.element.find(".cbRepeatRowAdd").filter((function(){return e(this).closest(".cbRepeat").is(i.element)})).off("click.cbrepeat",i.addHandler);i.element.find(".cbRepeatRowRemove").filter((function(){return e(this).closest(".cbRepeat").is(i.element)})).off("click.cbrepeat",i.removeHandler);i.element.off(".cbrepeat");e.each(t,(function(e,a){if(a.element==i.element){t.splice(e,1);return false}return true}));i.element.removeData("cbrepeat");i.element.triggerHandler("cbrepeat.destroyed",[i]);return this},instances:function(){return t}};function a(t){const i=e(this).data("cbrepeat");if(!i){return false}const a=i.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(i.element)}));if(i.settings.max&&a.length>=i.settings.max){return false}const n=a.last();const r=[];n.find("input:checked").each((function(){r.push(e(this))}));const l=[];const o=[];const f=[];let d=n;for(let a=0;a<t;++a){let a=n.find("*");if(i.settings.ignore){a=a.not(i.settings.ignore)}a.each((function(){if(e(this).triggerHandler("cloning")){l.push(e(this))}}));const r=n.clone(true);if(t>1){d=i.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(i.element)})).last()}r.insertAfter(d);let c=r.find(".cbRepeat");if(i.settings.ignore){c=c.not(i.settings.ignore)}c.each((function(){const t=this;const i=e(this).find(".cbRepeatRow:not(:first)").filter((function(){return e(this).closest(".cbRepeat").is(e(t))}));i.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");i.remove()}));a=r.find("*");if(i.settings.ignore){a=a.not(i.settings.ignore)}a.each((function(){if(e(this).is("input,select,textarea")&&!e(this).hasClass("cbRepeatNoReset")&&!e(this).closest(".cbRepeatNoReset").length){const t=e(this).attr("type");let i=e(this).data("cbrepeat-default");if(typeof i!="undefined"){i=e.trim(i)}else{i=null}if(t==="checkbox"||t==="radio"){if(i){if(t==="checkbox"&&i.indexOf("|*|")!==-1){if(i.split("|*|").indexOf(e(this).val())!==-1){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}else{if(e(this).val()===i){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}}else{if(t==="radio"&&(e(this).siblings('input[type="radio"]').length+1===2&&e(this).val()==="0"||e(this).val()==="")){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}if(t==="radio"&&e(this).siblings('input[type="radio"]').length+1===2&&e(this).closest(".cbRadioButtonsYesNo").length){if(e(this).val()==="0"){e(this).next("label").addClass("btn-danger")}else{e(this).next("label").addClass("btn-success")}}if(t==="radio"){e(this).next("label").removeClass("active")}}else{if(i){if(e(this).is("select[multiple]")){i=i.split("|*|")}e(this).val(i)}else{e(this).val("");if(e(this).is("select")){if(!e(this).children('option[value=""]:first').length){e(this).val(e(this).children('option[value!=""]:first').val())}}}}}o.push(e(this))}));f.push(r);s.call(r,i)}c(i);e.each(r,(function(e,t){t.prop("checked",true)}));e.each(l,(function(e,t){t.triggerHandler("rebind")}));e.each(o,(function(e,t){t.triggerHandler("cloned")}));i.element.triggerHandler("cbrepeat.add",[i,n,t,f,l,o]);return true}function n(t){const i=[];const a=t.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(t.element)}));let n=a.length-1;a.each((function(){const t=e(this);const a=t.data("cbrepeat-index");if(a){i.push(a);return false}t.find(".cbRepeatRowIndex,*[id],*[for],*[name],*[data-cbrepeat-fallback-id],*[data-cbrepeat-fallback-for],*[data-cbrepeat-fallback-name]").filter((function(){return e(this).closest(".cbRepeatRow").is(t)})).each((function(){const t=e(this);if(t.hasClass("cbRepeatRowIndex")){let e;if(t.is("input")){e=parseInt(t.val())}else{e=parseInt(t.text())}if(e>=0){i.push(e);return false}}if(t.attr("id")||t.attr("data-cbrepeat-fallback-id")){let e="id";if(!t.attr("id")){e="data-cbrepeat-fallback-id"}const a=t.attr(e);if(/^(.*_{2,})(\d+)(_{2,}\w+)$/g.test(a)){const e=parseInt(a.replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$2"));if(e>=0){i.push(e);return false}}}if(t.attr("for")||t.attr("data-cbrepeat-fallback-for")){let e="for";if(!t.attr("for")){e="data-cbrepeat-fallback-for"}const a=t.attr(e);if(/^(.*_{2,})(\d+)(_{2,}\w+)$/g.test(a)){const e=parseInt(a.replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$2"));if(e>=0){i.push(e);return false}}}if(t.attr("name")||t.attr("data-cbrepeat-fallback-name")){let e="name";if(!t.attr("name")){e="data-cbrepeat-fallback-name"}const a=t.attr(e);if(/^(.*_{2,})(\d+)(_{2,}\w+)$/g.test(a)){const e=parseInt(a.replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$2"));if(e>=0){i.push(e);return false}}}}))}));if(i.length){n=Math.max(...i)}return n}function r(t){var i=e(this).data("cbrepeat");if(!i){return false}var a=i.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(i.element)}));if(i.settings.min&&a.length<=i.settings.min){return false}if(!t){t=a.last()}t.find('.cbTabs,.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");t.find(".cbRepeat").off("remove.cbrepeat");t.remove();c(i);i.element.triggerHandler("cbrepeat.remove",[i,t]);return true}function s(t){t.rowIndex=t.rowIndex+1;const i=e(this);const a={};let n=e(this).find("*[id],*[for],*[name],*[data-cbrepeat-fallback-id],*[data-cbrepeat-fallback-for],*[data-cbrepeat-fallback-name]").filter((function(){return e(this).closest(".cbRepeatRow").is(i)}));if(t.settings.ignore){n=n.not(t.settings.ignore)}const r=e(this).find(".cbRepeatRowIndex").filter((function(){return e(this).closest(".cbRepeatRow").is(i)}));if(r.length){r.each((function(){if(e(this).is("input")){e(this).val(t.rowIndex)}else{e(this).html(t.rowIndex)}}))}n.each((function(){if(e(this).attr("id")||e(this).attr("data-cbrepeat-fallback-id")){let i="id";if(!e(this).attr("id")){i="data-cbrepeat-fallback-id"}const n=e(this).attr(i);const r=n.replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$1"+t.rowIndex+"$3");const s=n.replace("cbfr_","").replace("cbfv_","").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");const c=r.replace("cbfr_","").replace("cbfv_","").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");if(s!==c){if(!e(this).data("orgId")){e(this).data("orgId",n)}e(this).attr(i,r);e(this).triggerHandler("modified",[n,r,t.rowIndex]);let o=e(this).closest(".cbRepeatRow").find('*[id*="'+s+'"],*[id*="'+s.replace(/_{2,}/g,"__")+'"],*[data-cbrepeat-fallback-id*="'+s+'"],*[id*="'+s.replace(/_{2,}/g,"__")+'"]');if(t.settings.ignore){o=o.not(t.settings.ignore)}o.each((function(){if(e(this).attr("data-cbrepeat-fallback-id")){const t=e(this).attr("data-cbrepeat-fallback-id");const i=t.replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__"));if(t!==i){e(this).attr("data-cbrepeat-fallback-id",i)}}if(e(this).attr("id")){const i=e(this).attr("id");const n=i.replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__"));if(i===n){return}if(!e(this).data("orgId")){e(this).data("orgId",i)}e(this).attr("id",n);l.call(a,i,n,s,c);e(this).triggerHandler("modified",[i,n,t.rowIndex])}}));l.call(a,n,r,s,c)}}if(e(this).attr("for")||e(this).attr("data-cbrepeat-fallback-for")){let i="for";if(!e(this).attr("for")){i="data-cbrepeat-fallback-for"}const a=e(this).attr(i);const n=a.replace(/^(.*)(\[\d+])(\[\w+])$/g,"$1["+t.rowIndex+"]$3").replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$1"+t.rowIndex+"$3");const r=a.replace(/\[[a-zA-Z0-9]+]$/g,"").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");const s=n.replace(/\[[a-zA-Z0-9]+]$/g,"").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");if(r!==s){if(!e(this).data("orgFor")){e(this).data("orgFor",a)}e(this).attr(i,n);e(this).triggerHandler("modified-for",[a,n,t.rowIndex]);let c=e(this).closest(".cbRepeatRow").find('*[for*="'+r+'"],*[data-cbrepeat-fallback-for*="'+r+'"]');if(t.settings.ignore){c=c.not(t.settings.ignore)}c.each((function(){if(e(this).attr("data-cbrepeat-fallback-for")){const t=e(this).attr("data-cbrepeat-fallback-for");const i=t.replace(r,s);if(t!==i){e(this).attr("data-cbrepeat-fallback-for",i)}}if(e(this).attr("for")){const i=e(this).attr("for");if(!e(this).data("orgFor")){e(this).data("orgFor",e(this).attr("for"))}e(this).attr("for",e(this).attr("for").replace(r,s));const a=e(this).attr("for");if(i===a){return}e(this).triggerHandler("modified-for",[i,a,t.rowIndex])}}))}}if(e(this).attr("name")||e(this).attr("data-cbrepeat-fallback-name")){let i="name";if(!e(this).attr("name")){i="data-cbrepeat-fallback-name"}const a=e(this).attr(i);const n=a.replace(/^(.*)(\[\d+])(\[\w+])$/g,"$1["+t.rowIndex+"]$3").replace(/^(.*_{2,})(\d+)(_{2,}\w+)$/g,"$1"+t.rowIndex+"$3");const r=a.replace(/\[[a-zA-Z0-9]+]$/g,"").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");const s=n.replace(/\[[a-zA-Z0-9]+]$/g,"").replace(/^(.*_{2,}\d+)_{2,}\w+/g,"$1");if(r!==s){if(!e(this).data("orgName")){e(this).data("orgName",e(this).attr(i))}e(this).attr(i,n);e(this).triggerHandler("modified-name",[a,n,t.rowIndex]);let c=e(this).closest(".cbRepeatRow").find('*[name*="'+r+'"],*[data-cbrepeat-fallback-name*="'+r+'"]');if(t.settings.ignore){c=c.not(t.settings.ignore)}c.each((function(){if(e(this).attr("data-cbrepeat-fallback-name")){const t=e(this).attr("data-cbrepeat-fallback-name");const i=t.replace(r,s);if(t!==i){e(this).attr("data-cbrepeat-fallback-name",i)}}if(e(this).attr("name")){const i=e(this).attr("name");const a=e(this).attr("name").replace(r,s);if(i===a){return}if(!e(this).data("orgName")){e(this).data("orgName",i)}e(this).attr("name",a);e(this).triggerHandler("modified-name",[i,a,t.rowIndex])}}))}}}));if(a&&typeof cbHideFields!=="undefined"){Object.assign(cbHideFields,a);cbInitFields(a)}t.element.triggerHandler("cbrepeat.updated",[t,i])}function c(t){const i=t.element.find(".cbRepeatRow").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).length;if(i>t.settings.min){t.element.find(".cbRepeatRowRemove").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(){e(this).removeClass("hidden");const t=e(this).closest(".cbRepeatRowIncrement");if(t.length){t.removeClass("hidden")}}));if(t.settings.sortable){t.element.sortable("enable")}}else{t.element.find(".cbRepeatRowRemove").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(){e(this).addClass("hidden");const t=e(this).closest(".cbRepeatRowIncrement");if(t.length){t.addClass("hidden")}}));if(t.settings.sortable){t.element.sortable("disable")}}if(t.settings.max){if(i>=t.settings.max){t.element.find(".cbRepeatRowAdd").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(){e(this).addClass("hidden");const t=e(this).closest(".cbRepeatRowIncrement");if(t.length){t.addClass("hidden")}}))}else{t.element.find(".cbRepeatRowAdd").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(){e(this).removeClass("hidden");const t=e(this).closest(".cbRepeatRowIncrement");if(t.length){t.removeClass("hidden")}}))}}if(!t.settings.sortable||i<=1){t.element.find(".cbRepeatRowSort").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).addClass("hidden")}else if(i>1){t.element.find(".cbRepeatRowSort").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).removeClass("hidden")}t.element.find(".cbRepeatCount").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(){if(e(this).is("input")){e(this).val(i)}else{e(this).html(i)}}));t.element.find(".cbRepeatRowNumber").filter((function(){return e(this).closest(".cbRepeat").is(t.element)})).each((function(t){if(e(this).is("input")){e(this).val(t+1)}else{e(this).html(t+1)}}));if(i===t.settings.min){t.element.addClass("cbRepeatMin")}else if(i===t.settings.max){t.element.addClass("cbRepeatMax")}else{t.element.removeClass("cbRepeatMin cbRepeatMax")}}function l(e,t,i,a){if(typeof cbHideFields==="undefined"||typeof cbHideFields[e]==="undefined"){return}this[t]={};this[t].element=cbHideFields[e].element.replace(i,a).replace(i.replace(/_{2,}/g,"__"),a.replace(/_{2,}/g,"__"));this[t].conditions=[];cbHideFields[e].conditions.forEach(((e,n)=>{this[t].conditions[n]={operator:e.operator,value:e.value,show:[],set:[]};e.show.forEach(((e,r)=>{if(e){this[t].conditions[n].show[r]=e.replace(i,a).replace(i.replace(/_{2,}/g,"__"),a.replace(/_{2,}/g,"__"))}}));e.set.forEach(((e,r)=>{if(e){this[t].conditions[n].set[r]=e.replace(i,a).replace(i.replace(/_{2,}/g,"__"),a.replace(/_{2,}/g,"__"))}}))}))}e.fn.cbrepeat=function(e){if(i[e]){return i[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return i.init.apply(this,arguments)}return this};e.fn.cbrepeat.dataMap={sortable:"cbrepeat-sortable",ignore:"cbrepeat-ignore",add:"cbrepeat-add",remove:"cbrepeat-remove",min:"cbrepeat-min",max:"cbrepeat-max",limit:"cbrepeat-limit"};e.fn.cbrepeat.defaults={init:true,useData:true,sortable:true,ignore:null,add:true,remove:true,min:1,max:0,limit:25}})(jQuery);