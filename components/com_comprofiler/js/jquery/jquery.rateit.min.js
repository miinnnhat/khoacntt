/*! RateIt | v1.1.5 / 03/10/2021
    https://github.com/gjunge/rateit.js | Twitter: @gjunge

    MODIFIED: implement width calculation for hidden elements when using font based stars
*/
(function(e){var t={};e.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}};e.fn.rateit=function(a,r){var n=1;var s={};var l="init";var d=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(this.length===0){return this}var o=typeof a;if(o=="object"||a===undefined||a===null){s=e.extend({},e.fn.rateit.defaults,a)}else if(o=="string"&&a!=="reset"&&r===undefined){return this.data("rateit"+d(a))}else if(o=="string"){l="setvalue"}return this.each((function(){var o=e(this);var f=function(e,t){if(t!=null){var i="aria-value"+(e=="value"?"now":e);var a=o.find(".rateit-range");if(a.attr(i)!=undefined){a.attr(i,t)}}arguments[0]="rateit"+d(e);return o.data.apply(o,arguments)};if(a=="reset"){var u=f("init");for(var v in u){o.data(v,u[v])}if(f("backingfld")){var h=e(f("backingfld"));if(h[0].nodeName=="SELECT"&&h[0].getAttribute("data-rateit-valuesrc")==="index"){h.prop("selectedIndex",f("value"))}else{h.val(f("value"))}h.trigger("change");if(h[0].min){h[0].min=f("min")}if(h[0].max){h[0].max=f("max")}if(h[0].step){h[0].step=f("step")}}o.trigger("reset")}if(!o.hasClass("rateit")){o.addClass("rateit")}var m=o.css("direction")!="rtl";if(l=="setvalue"){if(!f("init")){throw"Can't set value before init"}if(a=="readonly"&&r==true&&!f("readonly")){o.find(".rateit-range").off();f("wired",false)}if(a=="value"){r=r==null?f("min"):Math.max(f("min"),Math.min(f("max"),r))}if(f("backingfld")){var h=e(f("backingfld"));if(h[0].nodeName=="SELECT"&&h[0].getAttribute("data-rateit-valuesrc")==="index"){if(a=="value"){h.prop("selectedIndex",r)}}else{if(a=="value"){h.val(r)}}if(a=="min"&&h[0].min){h[0].min=r}if(a=="max"&&h[0].max){h[0].max=r}if(a=="step"&&h[0].step){h[0].step=r}}f(a,r)}if(!f("init")){f("mode",f("mode")||s.mode);f("icon",f("icon")||s.icon);f("min",isNaN(f("min"))?s.min:f("min"));f("max",isNaN(f("max"))?s.max:f("max"));f("step",f("step")||s.step);f("readonly",f("readonly")!==undefined?f("readonly"):s.readonly);f("resetable",f("resetable")!==undefined?f("resetable"):s.resetable);f("backingfld",f("backingfld")||s.backingfld);f("starwidth",f("starwidth")||s.starwidth);f("starheight",f("starheight")||s.starheight);f("value",Math.max(f("min"),Math.min(f("max"),!isNaN(f("value"))?f("value"):!isNaN(s.value)?s.value:s.min)));f("ispreset",f("ispreset")!==undefined?f("ispreset"):s.ispreset);if(f("backingfld")){var h=e(f("backingfld")).hide();if(h.attr("disabled")||h.attr("readonly")){f("readonly",true)}if(h[0].nodeName=="INPUT"){if(h[0].type=="range"||h[0].type=="text"){f("min",parseInt(h.attr("min"))||f("min"));f("max",parseInt(h.attr("max"))||f("max"));f("step",parseInt(h.attr("step"))||f("step"))}}if(h[0].nodeName=="SELECT"&&h[0].options.length>1){if(h[0].getAttribute("data-rateit-valuesrc")==="index"){f("min",!isNaN(f("min"))?f("min"):Number(h[0].options[0].index));f("max",Number(h[0].options[h[0].length-1].index));f("step",Number(h[0].options[1].index)-Number(h[0].options[0].index))}else{f("min",!isNaN(f("min"))?f("min"):Number(h[0].options[0].value));f("max",Number(h[0].options[h[0].length-1].value));f("step",Number(h[0].options[1].value)-Number(h[0].options[0].value))}var c=h.find("option[selected]");if(c.length==1){if(h[0].getAttribute("data-rateit-valuesrc")==="index"){f("value",c[0].index)}else{f("value",c.val())}}}else{f("value",h.val())}}var g=o[0].nodeName=="DIV"?"div":"span";n++;var p='<button id="rateit-reset-{{index}}" type="button" data-role="none" class="rateit-reset" aria-label="'+e.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"><span></span></button><{{element}} id="rateit-range-{{index}}" class="rateit-range"'+(f("readonly")==true?"":' tabindex="0"')+' role="slider" aria-label="'+e.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+f("min")+'" aria-valuemax="'+f("max")+'" aria-valuenow="'+f("value")+'"><{{element}} class="rateit-empty"></{{element}}><{{element}} class="rateit-selected"></{{element}}><{{element}} class="rateit-hover"></{{element}}></{{element}}>';o.append(p.replace(/{{index}}/gi,n).replace(/{{element}}/gi,g));if(!m){o.find(".rateit-reset").css("float","right");o.find(".rateit-selected").addClass("rateit-selected-rtl");o.find(".rateit-hover").addClass("rateit-hover-rtl")}if(f("mode")=="font"){o.addClass("rateit-font").removeClass("rateit-bg")}else{o.addClass("rateit-bg").removeClass("rateit-font")}f("init",JSON.parse(JSON.stringify(o.data())))}var b=f("mode")=="font";if(!b){o.find(".rateit-selected, .rateit-hover").height(f("starheight"))}var x=o.find(".rateit-range");if(b){var w=f("icon");var y=f("max")-f("min");var N="";for(var k=0;k<y;k++){N+=w}x.find("> *").text(N);var C=x.css("font-size");var E=x.width();if(E===0){if(!t.hasOwnProperty(C)){var M=x.css("width");var S=x.css("height");var T=x.clone(false).attr({id:""}).css({position:"absolute",display:"block",visibility:"hidden",width:"auto",height:"auto",minWidth:M&&M!="0px"?M:"auto",minHeight:S&&S!="0px"?S:"auto",padding:x.css("padding"),border:x.css("border"),margin:x.css("margin"),fontFamily:x.css("font-family"),fontSize:C,fontWeight:x.css("font-weight"),lineHeight:x.css("line-height"),boxSizing:x.css("box-sizing"),wordSpacing:x.css("word-spacing")}).appendTo("body");E=T.width();T.remove();t[C]=E}else{E=t[C]}}else{t[C]=E}f("starwidth",E/(f("max")-f("min")))}else{x.width(f("starwidth")*(f("max")-f("min"))).height(f("starheight"))}var I="rateit-preset"+(m?"":"-rtl");if(f("ispreset")){o.find(".rateit-selected").addClass(I)}else{o.find(".rateit-selected").removeClass(I)}if(f("value")!=null){var L=(f("value")-f("min"))*f("starwidth");o.find(".rateit-selected").width(L)}var A=o.find(".rateit-reset");if(A.data("wired")!==true){A.on("click",(function(t){t.preventDefault();A.trigger("blur");var i=e.Event("beforereset");o.trigger(i);if(i.isDefaultPrevented()){return false}o.rateit("value",null);o.trigger("reset")})).data("wired",true)}var D=function(t,i){var a=i.changedTouches?i.changedTouches[0].pageX:i.pageX;var r=a-e(t).offset().left;if(!m){r=x.width()-r}if(r>x.width()){r=x.width()}if(r<0){r=0}return L=Math.ceil(r/f("starwidth")*(1/f("step")))};var z=function(e){var t=e*f("starwidth")*f("step");var i=x.find(".rateit-hover");if(i.data("width")!=t){x.find(".rateit-selected").hide();i.width(t).show().data("width",t);var a=[e*f("step")+f("min")];o.trigger("hover",a).trigger("over",a)}};var P=function(t){var i=e.Event("beforerated");o.trigger(i,[t]);if(i.isDefaultPrevented()){return false}f("value",t);if(f("backingfld")){if(h[0].nodeName=="SELECT"&&h[0].getAttribute("data-rateit-valuesrc")==="index"){e(f("backingfld")).prop("selectedIndex",t).trigger("change")}else{e(f("backingfld")).val(t).trigger("change")}}if(f("ispreset")){x.find(".rateit-selected").removeClass(I);f("ispreset",false)}x.find(".rateit-hover").hide();x.find(".rateit-selected").width(t*f("starwidth")-f("min")*f("starwidth")).show();o.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[t]);return true};if(!f("readonly")){if(!f("resetable")){A.hide()}if(!f("wired")){x.on("touchmove touchend",i);x.on("mousemove",(function(e){var t=D(this,e);z(t)}));x.on("mouseleave",(function(e){x.find(".rateit-hover").hide().width(0).data("width","");o.trigger("hover",[null]).trigger("over",[null]);x.find(".rateit-selected").show()}));x.on("mouseup",(function(e){var t=D(this,e);var i=t*f("step")+f("min");P(i);x.trigger("blur")}));x.on("keyup",(function(e){if(e.which==38||e.which==(m?39:37)){P(Math.min(f("value")+f("step"),f("max")))}if(e.which==40||e.which==(m?37:39)){P(Math.max(f("value")-f("step"),f("min")))}}));f("wired",true)}if(f("resetable")){A.show()}}else{A.hide()}x.attr("aria-readonly",f("readonly"))}))};function i(e){var t=e.originalEvent.changedTouches,i=t[0],a="";switch(e.type){case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var r=document.createEvent("MouseEvent");r.initMouseEvent(a,true,true,window,1,i.screenX,i.screenY,i.clientX,i.clientY,false,false,false,false,0,null);i.target.dispatchEvent(r);e.preventDefault()}e.fn.rateit.defaults={min:0,max:5,step:.5,mode:"bg",icon:"â˜…",starwidth:16,starheight:16,readonly:false,resetable:true,ispreset:false};e((function(){e("div.rateit, span.rateit").rateit()}))})(jQuery);