Nui.Extensions.tinymce={},Nui.Extensions.tinymce.settings={},Nui.Extensions.tinymce.counter=0,Nui.Extensions.tinymce.remove=function(node,selector){node.querySelectorAll(selector).forEach((function(textarea){textarea.getAttribute("id")&&tinymce.remove("#"+textarea.getAttribute("id"))}))},Nui.Extensions.tinymce.init=function(node,selector){Nui.Extensions.tinymce.remove(node,selector),node.querySelectorAll(selector).forEach((function(textarea){textarea.getAttribute("id")||(textarea.setAttribute("id","tinymce-"+Nui.Extensions.tinymce.counter),Nui.Extensions.tinymce.counter++);const image_upload_handler=(blobInfo,progress)=>new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest;xhr.withCredentials=!1,xhr.open("POST",tinymceSettings.images_upload_url),xhr.upload.onprogress=e=>{progress(e.loaded/e.total*100)},xhr.onload=()=>{if(200!=xhr.status)return void reject({message:"HTTP Error: "+xhr.status,remove:!0});const json=JSON.parse(xhr.responseText);null==json.error?resolve(json.location):reject({message:'<span style="color:red">'+json.error+"</span>",remove:!0})},xhr.onerror=()=>{reject("Upload failed due to connection error. Code: "+xhr.status)};const formData=new FormData;formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)});var tinymceSettings={width:"100%",height:500,plugins:["autolink","lists","link","image","charmap","preview","anchor","pagebreak","searchreplace","wordcount","visualblocks","visualchars","code","fullscreen","media","save","table","directionality","emoticons","codesample"],toolbar:textarea.getAttribute("data-toolbar")?textarea.getAttribute("data-toolbar"):["code visualblocks | undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify","bullist numlist outdent indent | link image media | forecolor backcolor | hr | removeformat | preview"],image_advtab:!0,image_title:!0,images_upload_handler:image_upload_handler,visualblocks_default_state:!0,menu:{},relative_urls:!1,remove_script_host:!1,convert_urls:!1,protect:[/\<\/?(if|endif)\>/g,/<\?php.*?\?>/g],promotion:!1,browser_spellcheck:!0,setup:function(editor){let onChange=function(){const content=editor.getContent();if(textarea.value=content,textarea.getAttribute("data-field")){let content=editor.getContent({format:"html"});textarea.matches("[data-imagepicker]")&&(content=content.replace("<p>",""),content=content.replace("</p>","")),document.querySelector(textarea.getAttribute("data-field")).value=content}};editor.on("change",onChange),editor.on("input",onChange),textarea.matches("[data-imagepicker]")&&(editor.on("keydown",(function(e){e.preventDefault()})),editor.on("paste",(function(e){e.preventDefault()})))}};if(tinymceSettings.target=textarea,textarea.matches("[data-editable]")&&(tinymceSettings.inline=!0,tinymceSettings.menubar=!1,tinymceSettings.inline_boundaries="body"),textarea.matches("[data-imagepicker]")&&(tinymceSettings.inline=!1,tinymceSettings.menubar=!1,tinymceSettings.image_advtab=!1,tinymceSettings.image_dimensions=!1,tinymceSettings.image_description=!1,tinymceSettings.visualblocks_default_state=!1,tinymceSettings.statusbar=!1,tinymceSettings.relative_urls=!1,tinymceSettings.remove_script_host=!1,tinymceSettings.convert_urls=!1,tinymceSettings.valid_elements="img[src|alt|title],p",tinymceSettings.plugin=["image"],tinymceSettings.toolbar=["image"]),tinymceSettings.automatic_uploads=!0,tinymceSettings.file_picker_callback=(cb,value,meta)=>{const input=document.createElement("input");input.setAttribute("type","file"),input.setAttribute("accept","image/*"),input.addEventListener("change",e=>{const file=e.target.files[0],reader=new FileReader;reader.addEventListener("load",()=>{let id=file.name;const dotIndex=id.lastIndexOf(".");dotIndex>-1&&(id=id.substring(0,dotIndex));const blobCache=tinymce.activeEditor.editorUpload.blobCache,base64=reader.result.split(",")[1],blobInfo=blobCache.create(id,file,base64);blobCache.add(blobInfo),cb(blobInfo.blobUri(),{title:file.name})}),reader.readAsDataURL(file)}),input.click()},textarea.getAttribute("data-settings")&&textarea.getAttribute("data-settings")in window){let newSettings=window[textarea.getAttribute("data-settings")];Object.keys(newSettings).forEach(key=>{"setup"==key?tinymceSettings.setup=function(editor){editor.on("change",(function(){const content=editor.getContent();textarea.value=content})),newSettings[key](editor)}:tinymceSettings[key]=newSettings[key]}),void 0!==tinymceSettings.custom_emojis&&tinymce.Resource.add("tinymce.plugins.emoticons",tinymceSettings.custom_emojis)}textarea.getAttribute("data-eheight")&&(tinymceSettings.height=textarea.getAttribute("data-eheight")),textarea.getAttribute("data-ewidth")&&(tinymceSettings.width=textarea.getAttribute("data-ewidth")),textarea.getAttribute("placeholder")&&(tinymceSettings.placeholder=textarea.getAttribute("placeholder")),textarea.matches("[data-editablediv]")&&(document.querySelector(textarea.getAttribute("data-editablediv")).innerHTML=textarea.value,tinymceSettings.target=document.querySelector(textarea.getAttribute("data-editablediv")),tinymceSettings.inline=!0,tinymceSettings.inline_boundaries="body"),tinymce.init(tinymceSettings),textarea.addEventListener("saveEditor",e=>{null!=tinymce&&tinymce.triggerSave()})}))};